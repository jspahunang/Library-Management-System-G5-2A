<div class="book-mgmt page-section">
  <header class="book-mgmt__header">
    <h2 class="page-title">Book Management</h2>
  </header>

  <div class="book-mgmt__toolbar-bar">
    <div class="book-mgmt__filters">
      <div class="book-mgmt__search-wrap">
        <span class="book-mgmt__search-icon" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </span>
        <input
          type="search"
          placeholder="Search by title, author, or ISBN..."
          class="book-mgmt__search"
          [ngModel]="searchQuery()"
          (ngModelChange)="onSearch($event)"
          name="bookSearch"
        />
      </div>
    </div>
    <div class="book-mgmt__action">
      <button type="button" (click)="openAdd()" class="book-mgmt__add-btn">
        <span class="book-mgmt__add-icon">+</span>
        Add book
      </button>
    </div>
  </div>

  @if (showForm()) {
    <div class="book-mgmt__modal-backdrop" (click)="cancelForm()" role="presentation"></div>
    <div class="book-mgmt__modal" role="dialog" aria-modal="true" aria-labelledby="book-modal-title">
      <div class="book-mgmt__modal-dialog" (click)="$event.stopPropagation()">
        <header class="book-mgmt__modal-header">
          <h3 id="book-modal-title" class="book-mgmt__modal-title">{{ editingId() ? 'Edit book' : 'Add new book' }}</h3>
          <button type="button" class="book-mgmt__modal-close" (click)="cancelForm()" aria-label="Close">Ã—</button>
        </header>
        <form [formGroup]="form" (ngSubmit)="save()" class="book-mgmt__modal-form">
          <div class="book-mgmt__modal-body form-grid">
            <div class="form-group">
              <label class="form-label">Title</label>
              <input formControlName="booktitle" class="input input-sm" />
            </div>
            <div class="form-group">
              <label class="form-label">Author</label>
              <input formControlName="author" class="input input-sm" />
            </div>
            <div class="form-group">
              <label class="form-label">ISBN</label>
              <input formControlName="isbn" class="input input-sm" [readonly]="!!editingId()" />
            </div>
            <div class="form-group">
              <label class="form-label">Category</label>
              <input formControlName="category" class="input input-sm" />
            </div>
            <div class="form-group">
              <label class="form-label">Total copies</label>
              <input type="number" formControlName="totalCopies" class="input input-sm" min="1" />
            </div>
          </div>
          <footer class="book-mgmt__modal-footer">
            <button type="button" (click)="cancelForm()" class="btn btn-secondary">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </footer>
        </form>
      </div>
    </div>
  }

  <section class="book-mgmt__table-section card-lg">
    <div class="book-mgmt__table-meta">
      <span class="book-mgmt__count">{{ filteredBooks().length }} book{{ filteredBooks().length === 1 ? '' : 's' }}</span>
    </div>
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Author</th>
            <th>ISBN</th>
            <th>Category</th>
            <th>Available / Total</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (b of filteredBooks(); track b.bookid) {
            <tr>
              <td class="text-primary">{{ b.booktitle }}</td>
              <td>{{ b.author }}</td>
              <td>{{ b.isbn }}</td>
              <td>{{ b.category }}</td>
              <td>{{ b.availableCopies }} / {{ b.totalCopies }}</td>
              <td>
                <div class="cell-actions">
                  <button type="button" (click)="openEdit(b)" class="link-action">Edit</button>
                  <button type="button" (click)="delete(b.bookid)" class="link-action link-action-danger">Delete</button>
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="6" class="empty-cell">No books.</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </section>
</div>
